<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Provider Dashboard - ServiceSphere</title>

<link rel="stylesheet" href="css/style.css">

<style>

/* ---------- NAVBAR ---------- */

.user-info{
  color:white;
  margin-left:auto;
  display:flex;
  align-items:center;
  gap:15px;
}

.logout-btn{
  background:rgba(255,255,255,0.2);
  border:1px solid rgba(255,255,255,0.4);
  padding:8px 14px;
  border-radius:6px;
  cursor:pointer;
  color:white;
}

.logout-btn:hover{
  background:rgba(255,255,255,0.35);
}

/* ---------- DASHBOARD ---------- */

.dashboard{
  max-width:1100px;
  margin:auto;
  padding:30px;
}

.dashboard-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:25px;
}

.stats-card{
  background:#1e88e5;
  color:white;
  padding:10px 18px;
  border-radius:8px;
  font-weight:bold;
}

/* ---------- BOOKING CARD ---------- */

.booking-card{
  background:white;
  border-radius:12px;
  padding:20px;
  margin-bottom:18px;
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
  transition:.3s;
}

.booking-card:hover{
  transform:translateY(-3px);
}

.booking-card h3{
  color:#1e88e5;
  margin-bottom:8px;
}

.booking-card button{
  margin-top:10px;
  margin-right:8px;
  padding:8px 14px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  color:white;
}

.accept-btn{ background:#28a745; }
.complete-btn{ background:#007bff; }
.cancel-btn{ background:#dc3545; }

/* ---------- STATUS BADGES ---------- */

.status{
  padding:4px 10px;
  border-radius:20px;
  font-size:13px;
  color:white;
  margin-left:5px;
}

.status.pending{ background:orange; }
.status.accepted{ background:#007bff; }
.status.completed{ background:green; }
.status.cancelled{ background:red; }

</style>
</head>

<body>

<!-- ================= NAVBAR ================= -->

<header class="navbar">
  <h2>ServiceSphere</h2>

  <nav>
    <a href="#">Dashboard</a>
    <a href="#">Bookings</a>
    <a href="#">Profile</a>
  </nav>

  <div class="user-info">
    <span>Welcome, <strong id="userName"></strong></span>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>
</header>


<!-- ================= DASHBOARD ================= -->

<section class="dashboard">

  <div class="dashboard-header">
      <h2>Booking Requests</h2>

      <div class="stats-card">
          Pending Requests:
          <span id="pendingCount">0</span>
      </div>
  </div>

  <!-- â­ IMPORTANT CONTAINER -->
  <div id="bookingContainer"></div>

</section>


<script src="js/script.js"></script>

<script>

/* ================= LOAD USER ================= */

window.addEventListener("DOMContentLoaded", () => {

  const user = JSON.parse(localStorage.getItem("user") || "{}");
  document.getElementById("userName").textContent =
      user.name || "Provider";

  fetchProviderBookings();
});


/* ================= FETCH PROVIDER BOOKINGS ================= */

function fetchProviderBookings(){

  const token = localStorage.getItem("authToken");

  const container = document.getElementById("bookingContainer");

  if(!token){
    container.innerHTML = "<p>Please login first.</p>";
    return;
  }

  fetch("https://servicesphere-production.up.railway.app/provider-bookings",{
    method:"GET",
    headers:{
      "Authorization":"Bearer " + token
    }
  })
  .then(res => res.json())
  .then(data => {

      console.log("Bookings:",data);

      if(data.success){
          displayBookings(data.bookings);
      }else{
          container.innerHTML="<p>No bookings found.</p>";
      }

  })
  .catch(err=>{
      console.error(err);
      container.innerHTML="<p>Error loading bookings.</p>";
  });
}


/* ================= DISPLAY BOOKINGS ================= */

function displayBookings(bookings){

  const container = document.getElementById("bookingContainer");

  if(!bookings.length){
      container.innerHTML="<p>No booking requests yet.</p>";
      return;
  }

  /* Count pending */
  const pending = bookings.filter(
      b => (b.status || "Pending") === "Pending"
  ).length;

  document.getElementById("pendingCount").textContent = pending;

  container.innerHTML = bookings.map(b => `

    <div class="booking-card">

      <h3>${b.service}</h3>

      <p><strong>Customer:</strong> ${b.customer_name}</p>
      <p><strong>Date:</strong> ${b.booking_date} ${b.booking_time}</p>
      <p><strong>Address:</strong> ${b.address}</p>

      <p>
        <strong>Status:</strong>
        <span class="status ${(b.status || 'pending').toLowerCase()}">
          ${b.status || 'Pending'}
        </span>
      </p>

      <button class="accept-btn"
        onclick="updateBookingStatus(${b.id},'Accepted')">
        Accept
      </button>

      <button class="complete-btn"
        onclick="updateBookingStatus(${b.id},'Completed')">
        Complete
      </button>

      <button class="cancel-btn"
        onclick="updateBookingStatus(${b.id},'Cancelled')">
        Cancel
      </button>

    </div>

  `).join("");
}


/* ================= UPDATE STATUS ================= */

function updateBookingStatus(id,status){

  const token = localStorage.getItem("authToken");

  fetch(
    `https://servicesphere-production.up.railway.app/booking/${id}`,
    {
      method:"PUT",
      headers:{
        "Content-Type":"application/json",
        "Authorization":"Bearer " + token
      },
      body:JSON.stringify({status})
    }
  )
  .then(res=>res.json())
  .then(data=>{
      alert(data.message || "Status Updated");
      fetchProviderBookings();
  })
  .catch(err=>{
      console.error(err);
      alert("Update failed");
  });
}


/* ================= LOGOUT ================= */

function logout(){
  localStorage.removeItem("authToken");
  localStorage.removeItem("user");
  window.location.href="login.html";
}

</script>

</body>
</html>
